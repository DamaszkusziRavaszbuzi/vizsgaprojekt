<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Flippable Draggable Cards</title>
    <style>
      body {
        min-height: 100vh;
        margin: 0;
        background: #f0f0f0;
        overflow: hidden;
        position: relative;
      }
      .card-container {
        position: absolute;
        cursor: grab;
        user-select: none;
        transition: box-shadow 0.15s;
        z-index: 1;
      }
      .card-container.active {
        z-index: 10;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      }
      .card {
        width: 200px;
        height: 300px;
        perspective: 1000px;
      }
      .card-inner {
        width: 100%;
        height: 100%;
        position: relative;
        transition: transform 0.6s;
        transform-style: preserve-3d;
      }
      .card.flipped .card-inner {
        transform: rotateY(180deg);
      }
      .card-front,
      .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2em;
        border-radius: 16px;
        user-select: none;
      }
      .card-front {
        background: #fff;
        color: #333;
      }
      .card-back {
        background: #333;
        color: #fff;
        transform: rotateY(180deg);
      }
      #addCardBtn {
        position: fixed;
        top: 24px;
        left: 24px;
        z-index: 100;
        padding: 10px 18px;
        font-size: 1em;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.13);
        cursor: pointer;
        transition: background 0.2s;
      }
      #addCardBtn:hover {
        background: #444;
      }
    </style>
  </head>
  <body>
    <button id="addCardBtn">Add Card</button>
    <div id="cardsArea"></div>
    <script>
      const cardsArea = document.getElementById("cardsArea");
      const addCardBtn = document.getElementById("addCardBtn");

      let cardCount = 0;
      const CARD_WIDTH = 200;
      const CARD_HEIGHT = 300;

      // Utility to get random position so card is within viewport
      function getRandomPosition() {
        const padding = 30;
        const maxLeft = window.innerWidth - CARD_WIDTH - padding;
        const maxTop = window.innerHeight - CARD_HEIGHT - padding;
        const left = Math.random() * maxLeft + padding / 2;
        const top = Math.random() * maxTop + padding / 2;
        return { left, top };
      }

      // Card creation
      function createCard(frontText, backText) {
        cardCount++;
        const { left, top } = getRandomPosition();

        const cardContainer = document.createElement("div");
        cardContainer.className = "card-container";
        cardContainer.style.left = `${left}px`;
        cardContainer.style.top = `${top}px`;

        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
        <div class="card-inner">
          <div class="card-front">${frontText}</div>
          <div class="card-back">${backText}</div>
        </div>
      `;
        cardContainer.appendChild(card);

        // Drag & Flip logic
        let isDragging = false;
        let dragStart = null;
        let dragOffset = { x: 0, y: 0 };

        cardContainer.addEventListener("mousedown", (e) => {
          isDragging = false;
          dragStart = {
            x: e.clientX,
            y: e.clientY,
            left: cardContainer.offsetLeft,
            top: cardContainer.offsetTop,
          };
          dragOffset.x = e.clientX - cardContainer.offsetLeft;
          dragOffset.y = e.clientY - cardContainer.offsetTop;

          // Bring to front
          document
            .querySelectorAll(".card-container")
            .forEach((c) => c.classList.remove("active"));
          cardContainer.classList.add("active");

          function onMouseMove(e2) {
            const dx = e2.clientX - dragStart.x;
            const dy = e2.clientY - dragStart.y;
            if (!isDragging && (Math.abs(dx) > 5 || Math.abs(dy) > 5)) {
              isDragging = true;
            }
            if (isDragging) {
              let newLeft = e2.clientX - dragOffset.x;
              let newTop = e2.clientY - dragOffset.y;
              // Boundaries
              newLeft = Math.max(
                0,
                Math.min(newLeft, window.innerWidth - CARD_WIDTH)
              );
              newTop = Math.max(
                0,
                Math.min(newTop, window.innerHeight - CARD_HEIGHT)
              );
              cardContainer.style.left = newLeft + "px";
              cardContainer.style.top = newTop + "px";
            }
          }
          function onMouseUp(e2) {
            document.removeEventListener("mousemove", onMouseMove);
            document.removeEventListener("mouseup", onMouseUp);
            if (!isDragging) {
              card.classList.toggle("flipped");
            }
          }
          document.addEventListener("mousemove", onMouseMove);
          document.addEventListener("mouseup", onMouseUp);
        });

        // Prevent text selection
        card.addEventListener("dragstart", (e) => e.preventDefault());

        cardsArea.appendChild(cardContainer);
      }

      // Add card button
      addCardBtn.addEventListener("click", () => {
        createCard(`Front ${cardCount + 1}`, `Back ${cardCount + 1}`);
      });

      // Initial cards (e.g. 3 cards)
      for (let i = 1; i <= 3; i++) {
        createCard(`Front ${i}`, `Back ${i}`);
      }

      // Optional: reposition cards on resize to stay in viewport
      window.addEventListener("resize", () => {
        document.querySelectorAll(".card-container").forEach((container) => {
          let left = parseInt(container.style.left);
          let top = parseInt(container.style.top);
          if (left + CARD_WIDTH > window.innerWidth)
            container.style.left = window.innerWidth - CARD_WIDTH - 10 + "px";
          if (top + CARD_HEIGHT > window.innerHeight)
            container.style.top = window.innerHeight - CARD_HEIGHT - 10 + "px";
        });
      });
    </script>
  </body>
</html>
